var nja=function(){var t,e={},n="nja-group",a="nja-item",i="nja-active",r="nja-count";return e.init=function(a){t=a;for(var i=document.querySelectorAll("[data-"+n+"]"),r=0;r<i.length;r++){var u=e.getItems(i[r]);e.addHistory(i[r]);for(var o=0;o<u.length;o++)e.initCount(u[o]),u[o].addEventListener("click",e.action.bind(null,u[o],i[r]),!1)}},e.action=function(t,n){var a=e.isActive(t),i=e.getCount(t);e.addLoading(n),e.reset(n,i),e.toggle(t,n,a,i),e.ajax(t,n,a,i),e.timer(t,n,i)},e.toggle=function(t,n,a,i){a?(e.removeActive(t),e.resetCount(t),e.setValue(n,0)):(e.addActive(t),e.setCount(t,i),e.setValue(n,e.getValue(t)))},e.reset=function(t,n){for(var a=e.getItems(t),i=0;i<a.length;i++)e.resetCount(a[i],n),e.removeActive(a[i])},e.initCount=function(t){var n=t.querySelector("[data-"+r+"]"),a=parseInt(n.innerHTML),i=e.isActive(t);i&&a--,n.setAttribute("data-"+r,a)},e.getCount=function(t){return t.querySelector("[data-"+r+"]").getAttribute("data-"+r)},e.setCount=function(t,e){t.querySelector("[data-"+r+"]").innerHTML=parseInt(e)+1},e.resetCount=function(t,e){var n=t.querySelector("[data-"+r+"]");n.innerHTML=n.getAttribute("data-"+r)},e.timer=function(t,n,a){setTimeout(e.timeout.bind(null,t,n,a),e.getTime())},e.timeout=function(t,n,a){if(e.isLoading(n)){var i=n.getAttribute("data-nja-history");e.reset(n,a),n.setAttribute("data-nja-value",i),new_item=n.querySelector('[data-nja-item="'+i+'"]'),n.querySelector('[data-nja-item="'+i+'"]').classList.add("nja-active"),e.setCount(new_item,a)}},e.getTime=function(){return t&&"number"==typeof t.timeout?1e3*t.timeout:4e3},e.getItems=function(t){return t.querySelectorAll("[data-"+a+"]")},e.addHistory=function(t){t.setAttribute("data-nja-history",t.getAttribute("data-nja-value"))},e.addLoading=function(t){t.classList.add("nja-loading")},e.removeLoading=function(t){t.classList.remove("nja-loading")},e.isLoading=function(t){return t.classList.contains("nja-loading")},e.isActive=function(t){return t.classList.contains(i)},e.addActive=function(t){t.classList.add(i)},e.removeActive=function(t){t.classList.remove("nja-active")},e.getValue=function(t){return t.getAttribute("data-nja-item")},e.setValue=function(t,e){t.setAttribute("data-nja-value",e)},e.getGroupValue=function(t){return t.getAttribute("data-nja-value")},e.getId=function(t){return t.getAttribute("data-nja-group")},e.ajax=function(n,a,i,r,u){var o=new XMLHttpRequest,c=e.getGroupValue(a),s=e.getId(a),d=(new Date).getTime();o.onreadystatechange=function(){var u=(new Date).getTime(),l=u-d;if(l<e.getTime()&&o.readyState==XMLHttpRequest.DONE&&200==o.status&&(e.removeLoading(a),e.addHistory(a),t&&"function"==typeof t.ajaxCallback)){var g=[];r=i?r:parseInt(r)+1,g.count=parseInt(r),g.active=!i,g.current=parseInt(e.getValue(n)),g.selected=c,g.name=s,t.ajaxCallback(n,a,g)}},o.open("GET",t.root+"/nja/add/"+c+"/"+s,!0),o.send()},e}();